<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Document</title>
		<style type="text/css">
			#wrap {
				width: 400px;
				height: 400px;
				background-color: #ccc;
				margin: 0 auto;
			}
			
			.mindiv {
				width: 20px;
				height: 20px;
				background-color: orange;
				border: 1px solid lightblue;
				float: left;
				box-sizing: border-box;
			}
			
			.red {
				background-color: red;
			}
			
			.green {
				background-color: green;
			}
		</style>
	</head>

	<body>
		<div id="wrap"></div>
	</body>
	<script type="text/javascript">
		var wrap = document.getElementById("wrap");
		var rowNumber = 20;
		var collNumber = 20;
		//å­˜æ”¾æ‰€æœ‰divçš„äºŒä½æ•°ç»„
		//å­˜æ”¾çš„æ˜¯å°æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªæ•°ç»„ä»£è¡¨ä¸€è¡Œ
		var allDiv = [];
		//-----------------æ§åˆ¶æ•´ä¸ªæ¸¸æˆçš„å®šæ—¶å™¨*---------------
		var timer = null;
		//----------------ä¿å­˜ä¸Šä¸€æ¬¡çš„æ–¹å‘----------------
		var oldDir = "right";
		//------------------ğŸçš„å±æ€§-------------------
		//ğŸçš„é•¿åº¦
		var snakeLength = 3;
		//ğŸé»˜è®¤çš„æ‰€åœ¨è¡Œ
		var x = 0;
		var snakeHeader = snakeLength - 1;
		var direction = "right";
		//-------------------ç”¨æ¥è£…æ•´æ¡ğŸ------------------
		var snakeArray = [];
		//-------------------é£Ÿç‰©çš„åæ ‡--------------------
		var foodX = null;
		var foodY = null;
		//-------------------åˆ›å»ºæ¸¸æˆé¢æ¿-------------------
		creatMapAndArray();
		//------------------åˆ›å»ºäºŒç»´æ•°ç»„æ–¹æ³•-------------------
		function creatMapAndArray() {
			//å¤–å±‚foræ§åˆ¶è¡Œ
			//å†…å±‚foræ§åˆ¶åˆ—
			for (var i = 0; i < rowNumber; i++) {
				var rowArray = [];
				for (var j = 0; j < collNumber; j++) {
					var mindiv = document.createElement("div");
					mindiv.className = "mindiv";
					wrap.appendChild(mindiv);
					rowArray.push(mindiv);
				}
				allDiv.push(rowArray);
			}
		}
		//-----------------è®©ğŸåœ¨é¢æ¿ä¸Šå±•ç¤ºå‡ºæ¥---------------
		shwoMySnake();

		function shwoMySnake() {
			for (var i = 0; i < snakeLength; i++) {
				allDiv[0][i].className = "mindiv red";
				snakeArray[i] = allDiv[0][i];
			}
		}
		//------------------æ¸¸æˆå¼€å§‹æ–¹æ³•----------------------
		gameStart();
		//------------------æ¸¸æˆç»“æŸæ–¹æ³•----------------------
		function gameOver() {
			console.log("gameOver");
			clearTimeout(timer);
		}
		//-----------------æ˜¯å¦ç¢°åˆ°è‡ªå·±æ–¹æ³•--------------------
		function checkMe(tou) {
			for (var i = 0; i < snakeArray.length; i++) {
				if (snakeArray[i] == tou) {
					return true;
				}
			}
			return false;
		}
		//---------------é£Ÿç‰©æ˜¯å¦åˆ›å»ºåœ¨è‡ªå·±èº«ä¸Š----------------
		function isOnSanke() {
			if (allDiv[foodX][foodY].className == "mindiv red") {
				return true;
			} else {
				return false;
			}
		} //------------------åˆ›å»ºå®ç‰©çš„æ–¹æ³•--------------------
		createFood();

		function createFood() {
			foodX = parseInt(Math.random() * collNumber);
			foodY = parseInt(Math.random() * collNumber);
			if (isOnSanke()) {
				createFood();
			} else {
				allDiv[foodX][foodY].className = "mindiv green";
			}
		}
		//----------------ğŸå¤´æ˜¾ç¤ºçš„æ–¹æ³•---------------------
		function headShow() {
			snakeArray[snakeArray.length - 1].className = "mindiv red";
		}

		//----------------ğŸå°¾å·´æ¶ˆå¤±çš„æ–¹æ³•--------------------
		function tailHide() {
			snakeArray[0].className = "mindiv";
		}
		//----------------æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©æ–¹æ³•-------------------
		function isAteFood() {
			//ğŸå¤´çš„ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯å¦æ˜¯[foodX][foodY]
			var nextPointX = x;
			var nextPointY = snakeHeader;
			if (direction == "top") {
				nextPointX--;
			}
			if (direction == "bottom") {
				nextPointX++;
			}
			if (direction == "left") {
				nextPointY--;
			}
			if (direction == "right") {
				nextPointY++;
			}
			if (nextPointX == foodX && nextPointY == foodY) {
				return true;
			} else {
				return false;
			}
		}
		//------------------ç§»åŠ¨è‡ªå·±æ–¹æ³•--------------------
		function move() {
			for (var i = 0; i < snakeArray.length; i++) {
				snakeArray[i] = snakeArray[i + 1];
			}
		}
		//-----------------é”®ç›˜ç‚¹å‡»äº‹ä»¶-----------------------
		document.onkeydown = function(event) {
				var currentDir = event.keyCode;
				oldDir = direction;
				if (currentDir > 40 || currentDir < 37) {
					currentDir = oldDir;
				}
				//æ’é™¤ç›¸åçš„æ–¹å‘
				if (currentDir == 37 && oldDir == "right") {
					currentDir = "right";
				}
				if (currentDir == 38 && oldDir == "bottom") {
					currentDir = "bottom";
				}
				if (currentDir == 39 && oldDir == "left") {
					currentDir = "left";
				}
				if (currentDir == 40 && oldDir == "top") {
				currentDir = "top";
			}
				switch (event.keyCode) {
					case 37:
						//å·¦
						direction = "left";
						break;
					case 38:
						//ä¸Š
						direction = "top";
						break;
					case 39:
						//å³
						direction = "right";
						break;
					case 40:
						//ä¸‹
						direction = "bottom";
						break;
					default:
						break;
				}
			}
			//---------------æ§åˆ¶æ–¹å‘ç§»åŠ¨çš„æ–¹æ³•--------------------
		function gameStart() {
			//ğŸè¦å‘æŸä¸€ä¸ªæ–¹å‘æ¥ç§»åŠ¨
			switch (direction) {
				case "left":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (snakeHeader <= 0) {
						gameOver();
						break;
					}
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					var tou = allDiv[x][snakeHeader - 1];
					if (checkMe(tou)) {
						gameOver();
						break;
					}
					//å°¾å·´æ¶ˆå¤±
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						snakeArray.push(allDiv[foodX][foodY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x][snakeHeader - 1];
					}
					//ğŸå¤´æ˜¾ç¤º
					headShow();
					snakeHeader--;
					timer = setTimeout(gameStart, 200);
					break;
				case "right":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (snakeHeader + 1 >= collNumber) {
						gameOver();
						break;
					}
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					var tou = allDiv[x][snakeHeader + 1];
					if (checkMe(tou)) {
						gameOver();
						break;
					}
					//å°¾å·´æ¶ˆå¤±
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[foodX][foodY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x][snakeHeader + 1];
					}
					//ğŸå¤´æ˜¾ç¤º
					headShow();
					snakeHeader++;
					timer = setTimeout(gameStart, 200);
					break;
				case "top":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (x <= 0) {
						gameOver();
						break;
					}
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					var tou = allDiv[x - 1][snakeHeader];
					if (checkMe(tou)) {
						gameOver();
						break;
					}
					//å°¾å·´æ¶ˆå¤±
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[foodX][foodY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x - 1][snakeHeader];
					}
					//ğŸå¤´æ˜¾ç¤º
					headShow();
					x--;
					timer = setTimeout(gameStart, 200);
					break;
				case "bottom":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (x + 1 >= rowNumber) {
						gameOver();
						break;
					}
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					var tou = allDiv[x + 1][snakeHeader];
					if (checkMe()) {
						gameOver();
						break;
					}
					//å°¾å·´æ¶ˆå¤±
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[foodX][foodY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x + 1][snakeHeader];
					}
					//ğŸå¤´æ˜¾ç¤º
					headShow();
					x++;
					timer = setTimeout(gameStart, 200);
					break;
				default:
					break;
			}
		}
	</script>

</html>